#!/usr/bin/env bash

set -euo pipefail

WGX_ROOT="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
export WGX_ROOT

# shellcheck source=wgx_lib/lib/logging.bash
source "${WGX_ROOT}/wgx_lib/lib/logging.bash"

main() {
  local cmd="${1:-}"
  shift || true

  case "${cmd}" in
  guard | smoke | metrics | snapshot)
    local cmd_path="${WGX_ROOT}/wgx_lib/cmd/${cmd}.sh"
    if [[ -f "${cmd_path}" ]]; then
      # shellcheck source=/dev/null
      source "${cmd_path}"
      "wgx_cmd_${cmd}" "$@"
    else
      wgx_log_error "Unknown command: ${cmd}"
      exit 1
    fi
    ;;
  *)
    wgx_log_error "Unknown command: ${cmd}"
    exit 1
    ;;
  esac
}

main "$@"
